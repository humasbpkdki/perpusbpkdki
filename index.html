<!doctype html>
<html lang="en">

<head>
   <meta charset="utf-8">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <title>Perpustakaan BPK Perwakilan Provinsi DKI Jakarta</title>
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
   <link href="img/logo-bpk.png" rel="shortcut icon">
   <style>
      /* Fonts */
      @import url('https://fonts.googleapis.com/css2?family=Montserrat&display=swap');

      body {
         overflow: hidden;
         max-width: 100%;
         background-image: url(img/bg-perpus.jpg);
         background-size: cover;
         font-family: 'Montserrat', sans-serif;
      }

      /* Perpus */
      .perpus {
         background-color: rgba(164, 25, 111, 0.304);
      }

      #berhasil {
         display: none;
         opacity: 0;
         transition: opacity 0.5s ease-in-out;
      }

      /* Animasi untuk alert diisi */
      #diisi {
         display: none;
         opacity: 0;
         transition: opacity 0.5s ease-in-out;
      }

      .perpus .row {
         height: 100%;
      }

      .perpus form {
         background-color: rgba(0, 0, 0, 0.504);
         border-radius: 5px;
      }

      .perpus form label {
         color: white;
         font-weight: bold;
      }

      .perpus h1 {
         text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.299);
      }

      /* Survey */
      .popup .emot {
         height: 100vh;
      }

      .popup .col-lg-7 {
         background-color: white;
         box-shadow: 0 0 20px 3px rgba(0, 0, 0, 0.499);
      }

      .popup .col-lg-3 a {
         text-decoration: none;
      }

      .popup .col-lg-3 h4 {
         color: rgb(255, 255, 255);
      }

      .popup .orange {
         background-color: rgb(210, 143, 17);
      }

      .popup .col-lg-3 {
         transition: .3s all;
      }

      .popup .col-lg-3:hover {
         transform: translateY(-8px);
      }

      /* Hasil Survey */
      .button-survey .survey {
         background-color: #B38001;
         color: white;
         transition: .4s all;
      }

      .button-survey .survey:hover {
         transform: scale(.9);
      }

      /* Responsive */
      @media (max-width: 576px) {
         .popup .judul-survey {
            font-size: 1.2em;
         }
      }
   </style>
</head>

<body>
   <span class="perpus position-absolute top-0 bottom-0 end-0 start-0">
      <div class="row d-flex justify-content-center align-items-center">
         <div class="col-lg-5 col-sm-7">
            <h1 class="text-center text-white fw-bold">PERPUSTAKAAN</h1>
            <form class="p-3 mx-2" name="form-data-keperluan-perpustakaan">
               <div class="logo mb-3 d-flex justify-content-center">
                  <img src="img/LOGO BPK PWK DKI JAKARTA - PUTIH.png" width="250" alt="Logo BPK">
               </div>
               <div class="alert alert-success" role="alert" id="berhasil">
                  Terimakasih, pesan anda sudah kami terima
               </div>
               <div class="alert alert-warning" role="alert" id="diisi">
                  Form harus diisi semua!
               </div>
               <div class="mb-3">
                  <label for="nama" class="form-label">Nama Lengkap</label>
                  <input type="text" class="form-control" id="nama" name="nama" placeholder="Masukan nama lengkap anda">
               </div>
               <div class="mb-3">
                  <label for="instansi" class="form-label">Unit Kerja/Instansi</label>
                  <select class="form-select" id="instansi" aria-label="Default select example" name="instansi">
                     <option selected disabled>Pilih Unit Kerja/Instansi</option>
                     <option value="Subbag SDM">Subbag SDM</option>
                     <option value="Subbag Umum dan TI">Subbag Umum dan TI</option>
                     <option value="Subbag Humas">Subbag Humas</option>
                     <option value="Subbag TU Kalan">Subbag TU Kalan</option>
                     <option value="Subbag Keuangan">Subbag Keuangan</option>
                     <option value="Subbag Hukum">Subbag Hukum</option>
                     <option value="Sub Auditorat DKI Jakarta 1">Sub Auditorat DKI Jakarta 1</option>
                     <option value="Sub Auditorat DKI Jakarta 2">Sub Auditorat DKI Jakarta 2</option>
                     <option value="Sub Auditorat DKI Jakarta 3">Sub Auditorat DKI Jakarta 3</option>
                     <option value="Sub Auditorat DKI Jakarta 4">Sub Auditorat DKI Jakarta 4</option>
                     <option value="Lainnya">Lainnya</option>
                  </select>
               </div>
               <div class="mb-3">
                  <label for="keperluan" class="form-label">Keperluan</label>
                  <textarea class="form-control" id="keperluan" rows="3" name="keperluan"
                     placeholder="Apa keperluan anda?"></textarea>
               </div>
               <div class="tombol-kirim d-flex justify-content-center">
                  <button type="submit" class="btn btn-primary btn-kirim" style="width: 200px;"><i
                        class="bi bi-send-fill"></i> Kirim pesan</button>
                  <button class="btn btn-primary mx-2 btn-loading d-none" style="width: 200px;" type="button" disabled>
                     <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                     Tunggu...
                  </button>
               </div>
            </form>
         </div>
      </div>
   </span>

   <!-- Popup Penilaian -->
   <span class="popup position-absolute top-0 bottom-0 end-0 start-0">
      <div class="container">
         <div class="row emot d-flex justify-content-center align-items-center">
            <div class="col-lg-7 p-4">
               <div class="close text-end mb-4">
                  <a href=""><i class="bi bi-x-circle-fill fs-1 text-danger"></i></a>
               </div>
               <div class="alert alert-success" role="alert">
                  Terimakasih, atas kunjungan anda<img src="img/smiles.png" class="ms-2" width="30" alt="smiles">
               </div>
               <h4 class="text-center judul-survey fw-bold">MOHON PENILAIAN ANDA TERHADAP LAYANAN KAMI</h4>
               <div class="row my-4 pilihan">
                  <div class="col-lg-3 col-sm-3 col-6 p-3 bg-success">
                     <a href="" class="text-center pilih-survey" data-for="sangatPuas">
                        <div class="image mb-3 d-flex justify-content-center">
                           <img src="img/thumbs.png" width="100" alt="Sangat Puas">
                        </div>
                        <h4>Sangat Puas</h4>
                     </a>
                  </div>
                  <div class="col-lg-3 col-sm-3 col-6 p-3 bg-info">
                     <a href="" class="text-center pilih-survey" data-for="puas">
                        <div class="image mb-3 d-flex justify-content-center">
                           <img src="img/smile.png" width="100" alt="Puas">
                        </div>
                        <h4>Puas</h4>
                     </a>
                  </div>
                  <div class="col-lg-3 col-sm-3 col-6 p-3 orange">
                     <a href="" class="text-center pilih-survey" data-for="cukup">
                        <div class="image mb-3 d-flex justify-content-center">
                           <img src="img/neutral.png" width="100" alt="Cukup">
                        </div>
                        <h4>Cukup</h4>
                     </a>
                  </div>
                  <div class="col-lg-3 col-sm-3 col-6 p-3 bg-danger">
                     <a href="" class="text-center pilih-survey" data-for="tidakPuas">
                        <div class="image mb-3 d-flex justify-content-center">
                           <img src="img/sad.png" width="100" alt="Tidak Puas">
                        </div>
                        <h4>Tidak Puas</h4>
                     </a>
                  </div>
               </div>
               <h5 class="text-center">Survey Kepuasan Pengunjung</h5>
            </div>
         </div>
      </div>
   </span>

   <div class="button-survey position-fixed top-0 end-0 p-2 m-2">
      <button class="btn survey" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample"
         aria-expanded="false" aria-controls="collapseExample">
         <img src="img/survey.png" width="30" class="me-2" alt="Survey">Survey Kepuasan Pengunjung
      </button>
      <div class="collapse mt-3" id="collapseExample">
         <div class="card card-body">
            <table class="table table-dark table-striped">
               <tbody>
                  <tr>
                     <td>Sangat Puas</td>
                     <td id="sangatPuas">0</td>
                  </tr>
                  <tr>
                     <td>Puas</td>
                     <td id="puas">0</td>
                  </tr>
                  <tr>
                     <td>Cukup</td>
                     <td id="cukup">0</td>
                  </tr>
                  <tr>
                     <td>Tidak Puas</td>
                     <td id="tidakPuas">0</td>
                  </tr>
               </tbody>
            </table>
         </div>
      </div>
   </div>

   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous">
   </script>
   <script>
      // Form Data Keperluan Perpustakaan
      const scriptURL =
         'https://script.google.com/macros/s/AKfycbyV6MD2C3JazUQ4G5iat4DfPumCAiqXFNTw2zSl354xKtRmX0kiNYX6MZ0Wh6_48v1reg/exec';
      const form = document.forms['form-data-keperluan-perpustakaan'];
      const btnKirim = document.querySelector('.btn-kirim');
      const btnLoading = document.querySelector('.btn-loading');
      const alertBerhasil = document.getElementById('berhasil');
      const alertDiisi = document.getElementById('diisi');
      const popup = document.querySelector('.popup');

      // Sembunyikan popup secara default
      popup.style.display = 'none';

      form.addEventListener('submit', e => {
         e.preventDefault();

         // Periksa apakah ada inputan yang belum diisi
         let isFormValid = true;

         const namaInput = form.querySelector('#nama');
         const instansiInput = form.querySelector('#instansi');
         const keperluanInput = form.querySelector('#keperluan');

         if (namaInput.value.trim() === '' || instansiInput.value.trim() === '' || keperluanInput.value.trim() ===
            '') {
            isFormValid = false;
         }

         if (isFormValid) {
            btnLoading.classList.toggle('d-none');
            btnKirim.classList.toggle('d-none');
            fetch(scriptURL, {
                  method: 'POST',
                  body: new FormData(form),
               })
               .then(response => {
                  btnLoading.classList.toggle('d-none');
                  btnKirim.classList.toggle('d-none');
                  form.reset();
                  console.log('Success!', response);

                  // Tampilkan alert berhasil dengan animasi
                  alertBerhasil.style.display = 'block';
                  setTimeout(() => {
                     alertBerhasil.style.opacity = '1';
                  }, 10);

                  // Sembunyikan alert berhasil dengan animasi setelah 4 detik
                  setTimeout(() => {
                     alertBerhasil.style.opacity = '0';
                     setTimeout(() => {
                        alertBerhasil.style.display = 'none';
                     }, 500);
                  }, 4000);

                  // Tampilkan popup setelah 4 detik
                  setTimeout(() => {
                     popup.style.display = 'block';
                     // Tandai bahwa popup telah ditampilkan
                     localStorage.setItem('popupShown', 'true');
                  }, 4000);
               })
               .catch(error => {
                  console.error('Error!', error.message);
               });
         } else {
            // Tampilkan alert diisi dengan animasi jika ada inputan yang belum diisi
            alertDiisi.style.display = 'block';
            setTimeout(() => {
               alertDiisi.style.opacity = '1';
            }, 10);

            // Sembunyikan alert diisi dengan animasi setelah 4 detik
            setTimeout(() => {
               alertDiisi.style.opacity = '0';
               setTimeout(() => {
                  alertDiisi.style.display = 'none';
               }, 500);
            }, 4000);
         }
      });

      // Popup
      const closeIcon = document.querySelector('.bi-x-circle-fill');
      closeIcon.addEventListener('click', (e) => {
         e.preventDefault();
         popup.style.display = 'none';
      });

      // Mengambil semua elemen dengan class 'pilih-survey'
      const pilihSurveyLinks = document.querySelectorAll('.pilih-survey');

      // Memulai dengan mengisi nilai-nilai dari penyimpanan lokal ke elemen-elemen <td>
      for (const link of pilihSurveyLinks) {
         const targetId = link.getAttribute('data-for');
         const targetTd = document.getElementById(targetId);
         const nilaiDariStorage = localStorage.getItem(targetId);
         if (nilaiDariStorage !== null) {
            targetTd.innerText = nilaiDariStorage;
         }
      }

      // Sembunyikan class alert saat awalnya
      const alertPopup = document.querySelector('.popup .alert');
      alertPopup.style.display = 'none';

      // Mendengarkan klik pada setiap elemen 'pilih-survey'
      pilihSurveyLinks.forEach(link => {
         link.addEventListener('click', (e) => {
            e.preventDefault();

            // Mengambil nilai 'for' dari link yang diklik
            const targetId = link.getAttribute('data-for');

            // Mengambil elemen <td> dengan ID yang sesuai
            const targetTd = document.getElementById(targetId);

            // Mengambil nilai saat ini dari penyimpanan lokal (localStorage)
            let nilaiSaatIni = parseInt(localStorage.getItem(targetId)) || 0;

            // Menambahkan 1 ke nilai saat ini
            nilaiSaatIni += 1;

            // Menyimpan nilai yang diperbarui ke penyimpanan lokal
            localStorage.setItem(targetId, nilaiSaatIni.toString());

            // Mengubah nilai elemen <td> dengan nilai yang baru
            targetTd.innerText = nilaiSaatIni;

            // Sembunyikan class pilihan dan class judul-survey
            const pilihan = document.querySelector('.pilihan');
            const judulSurvey = document.querySelector('.judul-survey');
            pilihan.style.display = 'none';
            judulSurvey.style.display = 'none';

            // Tampilkan class alert dalam class popup selama 3 detik
            alertPopup.style.display = 'block';
            setTimeout(() => {
               alertPopup.style.display = 'none';
               // Sembunyikan class popup setelah alert hilang
               popup.style.display = 'none';
               window.location.reload();
            }, 3000);
         });
      });
   </script>
</body>

</html>